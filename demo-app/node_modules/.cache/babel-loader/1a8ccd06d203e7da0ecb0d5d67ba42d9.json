{"remainingRequest":"/Volumes/Voorhoede/www/deltares/delta-vue-components/demo-app/node_modules/babel-loader/lib/index.js!/Volumes/Voorhoede/www/deltares/delta-vue-components/demo-app/node_modules/eslint-loader/index.js??ref--13-0!/Volumes/Voorhoede/www/deltares/delta-vue-components/component-library/src/components/LayerListControls/useSortable.js","dependencies":[{"path":"/Volumes/Voorhoede/www/deltares/delta-vue-components/component-library/src/components/LayerListControls/useSortable.js","mtime":1604393507000},{"path":"/Volumes/Voorhoede/www/deltares/delta-vue-components/demo-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/Voorhoede/www/deltares/delta-vue-components/demo-app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/Voorhoede/www/deltares/delta-vue-components/demo-app/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIi9Wb2x1bWVzL1Zvb3Job2VkZS93d3cvZGVsdGFyZXMvZGVsdGEtdnVlLWNvbXBvbmVudHMvZGVtby1hcHAvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1ZvbHVtZXMvVm9vcmhvZWRlL3d3dy9kZWx0YXJlcy9kZWx0YS12dWUtY29tcG9uZW50cy9kZW1vLWFwcC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCB7IHdhdGNoLCBuZXh0VGljayB9IGZyb20gJ0B2dWUvY29tcG9zaXRpb24tYXBpJzsKaW1wb3J0IHsgU29ydGFibGUgfSBmcm9tICJzb3J0YWJsZWpzIjsKaW1wb3J0IHJlb3JkZXJMYXllckFycmF5IGZyb20gIi4vcmVvcmRlci1sYXllcnMtYXJyYXkiOwpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB1c2VTb3J0YWJsZShsYXllcnMsIGNvbXBvbmVudFJvb3QsIG9wZW5JdGVtcykgewogIHZhciB0cmVlVmlld1Jvb3RTZWxlY3RvciA9ICcudi10cmVldmlldyc7CiAgdmFyIHRyZWVWaWV3Q2hpbGRTZWxlY3RvciA9ICcudi10cmVldmlldy1ub2RlX19jaGlsZHJlbic7CiAgdmFyIHBhcmVudElkc1NlbGVjdG9yID0gJ2RhdGEtcGFyZW50LWlkcyc7CiAgdmFyIGhhbmRsZVNlbGVjdG9yID0gJy5zb3J0YWJsZS1oYW5kbGUnOwogIHZhciBjYWxsYmFja3MgPSBbXTsKICB2YXIgc29ydEluc3RhbmNlcyA9IFtdOwogIHZhciBjb25maWcgPSB7CiAgICBhbmltYXRpb246IDE1MCwKICAgIG9uVXBkYXRlOiBoYW5kbGVPcmRlclVwZGF0ZQogIH07CgogIGZ1bmN0aW9uIHJlZ2lzdGVyQ2FsbGJhY2soZm4pIHsKICAgIGNhbGxiYWNrcy5wdXNoKGZuKTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZU9yZGVyVXBkYXRlKGV2ZW50KSB7CiAgICB2YXIgb2xkRHJhZ2dhYmxlSW5kZXggPSBldmVudC5vbGREcmFnZ2FibGVJbmRleCwKICAgICAgICBuZXdEcmFnZ2FibGVJbmRleCA9IGV2ZW50Lm5ld0RyYWdnYWJsZUluZGV4LAogICAgICAgICRpdGVtID0gZXZlbnQuaXRlbTsKICAgIHZhciAkaGFuZGxlID0gJGl0ZW0ucXVlcnlTZWxlY3RvcihoYW5kbGVTZWxlY3Rvcik7CiAgICB2YXIgcGFyZW50SWRzID0gJGhhbmRsZS5nZXRBdHRyaWJ1dGUocGFyZW50SWRzU2VsZWN0b3IpOwoKICAgIGlmIChwYXJlbnRJZHMgPT09ICcnKSB7CiAgICAgIHBhcmVudElkcyA9IFtdOwogICAgfSBlbHNlIHsKICAgICAgcGFyZW50SWRzID0gcGFyZW50SWRzLnNwbGl0KCcsJyk7CiAgICB9CgogICAgdmFyIHJlb3JkZXJkTGF5ZXJzID0gcmVvcmRlckxheWVyQXJyYXkobGF5ZXJzLnZhbHVlLCBwYXJlbnRJZHMsIG9sZERyYWdnYWJsZUluZGV4LCBuZXdEcmFnZ2FibGVJbmRleCk7CiAgICBjYWxsYmFja3MuZm9yRWFjaChmdW5jdGlvbiAoZm4pIHsKICAgICAgcmV0dXJuIGZuKHJlb3JkZXJkTGF5ZXJzKTsKICAgIH0pOwogIH0KCiAgd2F0Y2gob3Blbkl0ZW1zLCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUob3Blbkl0ZW1zKSB7CiAgICAgIHZhciAkcm9vdEVsLCAkY2hpbGRFbHMsICRzb3J0YWJsZUVsczsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiBuZXh0VGljaygpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHNvcnRJbnN0YW5jZXMuZm9yRWFjaChmdW5jdGlvbiAoaW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5kZXN0cm95KCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc29ydEluc3RhbmNlcyA9IFtdOwogICAgICAgICAgICAgICRyb290RWwgPSBjb21wb25lbnRSb290LnF1ZXJ5U2VsZWN0b3IodHJlZVZpZXdSb290U2VsZWN0b3IpOwogICAgICAgICAgICAgICRjaGlsZEVscyA9IGNvbXBvbmVudFJvb3QucXVlcnlTZWxlY3RvckFsbCh0cmVlVmlld0NoaWxkU2VsZWN0b3IpOwogICAgICAgICAgICAgICRzb3J0YWJsZUVscyA9IFskcm9vdEVsXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KCRjaGlsZEVscykpOwogICAgICAgICAgICAgICRzb3J0YWJsZUVscy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgICAgc29ydEluc3RhbmNlcy5wdXNoKG5ldyBTb3J0YWJsZShlbCwgY29uZmlnKSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKICByZXR1cm4gewogICAgb25Tb3J0aW5nQ2hhbmdlOiByZWdpc3RlckNhbGxiYWNrCiAgfTsKfQ=="},{"version":3,"sources":["/Volumes/Voorhoede/www/deltares/delta-vue-components/component-library/src/components/LayerListControls/useSortable.js"],"names":["watch","nextTick","Sortable","reorderLayerArray","useSortable","layers","componentRoot","openItems","treeViewRootSelector","treeViewChildSelector","parentIdsSelector","handleSelector","callbacks","sortInstances","config","animation","onUpdate","handleOrderUpdate","registerCallback","fn","push","event","oldDraggableIndex","newDraggableIndex","$item","item","$handle","querySelector","parentIds","getAttribute","split","reorderdLayers","value","forEach","instance","destroy","$rootEl","$childEls","querySelectorAll","$sortableEls","el","onSortingChange"],"mappings":";;;;;;;;AAAA,SAASA,KAAT,EAAgBC,QAAhB,QAAgC,sBAAhC;AACA,SAASC,QAAT,QAAyB,YAAzB;AACA,OAAOC,iBAAP,MAA8B,wBAA9B;AAEA,eAAe,SAASC,WAAT,CAAqBC,MAArB,EAA6BC,aAA7B,EAA4CC,SAA5C,EAAuD;AACpE,MAAMC,oBAAoB,GAAG,aAA7B;AACA,MAAMC,qBAAqB,GAAG,4BAA9B;AACA,MAAMC,iBAAiB,GAAG,iBAA1B;AACA,MAAMC,cAAc,GAAG,kBAAvB;AACA,MAAMC,SAAS,GAAG,EAAlB;AAEA,MAAIC,aAAa,GAAG,EAApB;AAEA,MAAMC,MAAM,GAAG;AACbC,IAAAA,SAAS,EAAE,GADE;AAEbC,IAAAA,QAAQ,EAAEC;AAFG,GAAf;;AAKA,WAASC,gBAAT,CAA0BC,EAA1B,EAA8B;AAC5BP,IAAAA,SAAS,CAACQ,IAAV,CAAeD,EAAf;AACD;;AAED,WAASF,iBAAT,CAA2BI,KAA3B,EAAkC;AAAA,QACxBC,iBADwB,GAC8BD,KAD9B,CACxBC,iBADwB;AAAA,QACLC,iBADK,GAC8BF,KAD9B,CACLE,iBADK;AAAA,QACoBC,KADpB,GAC8BH,KAD9B,CACcI,IADd;AAGhC,QAAMC,OAAO,GAAGF,KAAK,CAACG,aAAN,CAAoBhB,cAApB,CAAhB;AACA,QAAIiB,SAAS,GAAGF,OAAO,CAACG,YAAR,CAAqBnB,iBAArB,CAAhB;;AACA,QAAIkB,SAAS,KAAK,EAAlB,EAAsB;AACpBA,MAAAA,SAAS,GAAG,EAAZ;AACD,KAFD,MAEO;AACLA,MAAAA,SAAS,GAAGA,SAAS,CAACE,KAAV,CAAgB,GAAhB,CAAZ;AACD;;AAED,QAAMC,cAAc,GAAG5B,iBAAiB,CAACE,MAAM,CAAC2B,KAAR,EAAeJ,SAAf,EAA0BN,iBAA1B,EAA6CC,iBAA7C,CAAxC;AACAX,IAAAA,SAAS,CAACqB,OAAV,CAAkB,UAAAd,EAAE;AAAA,aAAIA,EAAE,CAACY,cAAD,CAAN;AAAA,KAApB;AACD;;AAED/B,EAAAA,KAAK,CAACO,SAAD;AAAA,uEAAY,iBAAMA,SAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACTN,QAAQ,EADC;;AAAA;AAEfY,cAAAA,aAAa,CAACoB,OAAd,CAAsB,UAAAC,QAAQ;AAAA,uBAAIA,QAAQ,CAACC,OAAT,EAAJ;AAAA,eAA9B;AACAtB,cAAAA,aAAa,GAAG,EAAhB;AAEMuB,cAAAA,OALS,GAKC9B,aAAa,CAACqB,aAAd,CAA4BnB,oBAA5B,CALD;AAMT6B,cAAAA,SANS,GAMG/B,aAAa,CAACgC,gBAAd,CAA+B7B,qBAA/B,CANH;AAOT8B,cAAAA,YAPS,IAOOH,OAPP,4BAOmBC,SAPnB;AASfE,cAAAA,YAAY,CAACN,OAAb,CAAqB,UAAAO,EAAE,EAAI;AACzB3B,gBAAAA,aAAa,CAACO,IAAd,CAAmB,IAAIlB,QAAJ,CAAasC,EAAb,EAAiB1B,MAAjB,CAAnB;AACD,eAFD;;AATe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAZ;;AAAA;AAAA;AAAA;AAAA,MAAL;AAcA,SAAO;AACL2B,IAAAA,eAAe,EAAEvB;AADZ,GAAP;AAGD","sourcesContent":["import { watch, nextTick } from '@vue/composition-api'\nimport { Sortable } from \"sortablejs\";\nimport reorderLayerArray from \"./reorder-layers-array\";\n\nexport default function useSortable(layers, componentRoot, openItems) {\n  const treeViewRootSelector = '.v-treeview'\n  const treeViewChildSelector = '.v-treeview-node__children'\n  const parentIdsSelector = 'data-parent-ids'\n  const handleSelector = '.sortable-handle'\n  const callbacks = []\n\n  let sortInstances = []\n\n  const config = {\n    animation: 150,\n    onUpdate: handleOrderUpdate\n  }\n\n  function registerCallback(fn) {\n    callbacks.push(fn)\n  }\n\n  function handleOrderUpdate(event) {\n    const { oldDraggableIndex, newDraggableIndex, item: $item } = event;\n\n    const $handle = $item.querySelector(handleSelector);\n    let parentIds = $handle.getAttribute(parentIdsSelector);\n    if (parentIds === '') {\n      parentIds = []\n    } else {\n      parentIds = parentIds.split(',')\n    }\n\n    const reorderdLayers = reorderLayerArray(layers.value, parentIds, oldDraggableIndex, newDraggableIndex)\n    callbacks.forEach(fn => fn(reorderdLayers))\n  }\n\n  watch(openItems, async openItems => {\n    await nextTick()\n    sortInstances.forEach(instance => instance.destroy())\n    sortInstances = []\n\n    const $rootEl = componentRoot.querySelector(treeViewRootSelector);\n    const $childEls = componentRoot.querySelectorAll(treeViewChildSelector);\n    const $sortableEls = [$rootEl, ...$childEls];\n\n    $sortableEls.forEach(el => {\n      sortInstances.push(new Sortable(el, config))\n    });\n  })\n\n  return {\n    onSortingChange: registerCallback\n  }\n}"]}]}